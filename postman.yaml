trigger:
- main

pool:
  vmImage: 'windows-latest'

steps:
- script: |
    npm install -g newman newman-reporter-htmlextra
  displayName: 'Install Newman and Html reporter'
  
- script: |
    mkdir $(Build.ArtifactStagingDirectory)/reports
    newman run collection.json -r htmlextra --reporter-htmlextra-export $(Build.ArtifactStagingDirectory)/reports/report.html
  displayName: 'Run API Test and Create Reports Directory'


- task: PublishPipelineArtifact@1
  displayName: 'Publish HTML Report'
  inputs:
    targetPath: '$(Build.ArtifactStagingDirectory)/reports'
    ArtifactName: 'Report'